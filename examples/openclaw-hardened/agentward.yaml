# AgentWard Policy — OpenClaw Hardened Profile
#
# Production-ready policy for OpenClaw's default skill set.
# Tuned for security-first operation: shell blocked, writes gated,
# chaining restricted, PII redacted at data boundaries.
#
# Skill names match SKILL.md `name:` fields in ~/.clawdbot/skills/.
# Apply: agentward setup --gateway openclaw --policy agentward.yaml
# Scan:  agentward scan

version: "1.0"

skills:
  # --- Credentials ---
  1password:
    credentials:
      read: true
      write: false
      delete: false

  # --- Code execution ---
  coding-agent:
    shell:
      denied: true        # blocked — use require_approval gate below if needed
    filesystem:
      read: true
      write: false

  # --- GitHub ---
  github:
    issues:
      read: true
      create: true
      modify: true
      delete: false
    pull_requests:
      read: true
      create: true
      merge: false        # merges require human review
      delete: false
    actions:
      read: true
      trigger: false
    repos:
      read: true
      create: false
      delete: false

  # --- Messaging ---
  slack:
    messages:
      read: true
      send: true
      edit: true
      delete: false
    reactions:
      read: true
      add: true
      remove: true
    pins:
      read: true
      add: true
      remove: false

  discord:
    messages:
      read: true
      send: true
      delete: false
    channels:
      read: true
      create: false
      delete: false
    moderation:
      denied: true

  imsg:
    messages:
      read: true
      send: false          # sending iMessages requires approval
      delete: false

  # --- Email ---
  himalaya:
    email:
      read: true
      send: false           # drafts only — send requires approval
      draft: true
      delete: false
      filters:
        exclude_labels: ["Finance", "Medical", "Legal"]

  # --- Notes & Tasks ---
  apple-notes:
    notes:
      read: true
      create: true
      edit: true
      delete: false

  obsidian:
    vault:
      read: true
      create: true
      edit: true
      delete: false

  notion:
    pages:
      read: true
      create: true
      edit: true
      delete: false
    databases:
      read: true
      create: false
      delete: false

  trello:
    boards:
      read: true
    cards:
      read: true
      create: true
      move: true
      delete: false
    lists:
      read: true
      create: true
      delete: false

  things-mac:
    tasks:
      read: true
      create: true
      complete: true
      delete: false

  apple-reminders:
    reminders:
      read: true
      create: true
      complete: true
      delete: false

  # --- Media & Files ---
  nano-pdf:
    filesystem:
      read: true
      write: false

  camsnap:
    camera:
      capture: true
    filesystem:
      read: true
      write: true
      delete: false

  openai-image-gen:
    network:
      outbound: true
    filesystem:
      write: true
      delete: false

  video-frames:
    filesystem:
      read: true
      write: true
      delete: false

  # --- Weather (low risk) ---
  weather:
    network:
      outbound: true

  # --- Terminal ---
  tmux:
    shell:
      read: true
      execute: false        # read pane output only — no keystroke injection

  # --- Browsing ---
  bird:
    browser:
      read: true
      navigate: true
    filesystem:
      denied: true
    email:
      denied: true

  # --- Music ---
  spotify-player:
    playback:
      read: true
      control: true
    playlists:
      read: true
      modify: false

  sonoscli:
    playback:
      read: true
      control: true

  # --- Smart home ---
  openhue:
    lights:
      read: true
      control: true
    scenes:
      read: true
      activate: true

  # --- Voice ---
  voice-call:
    calls:
      denied: true         # voice calls are inherently high-risk
  sherpa-onnx-tts:
    audio:
      generate: true
    filesystem:
      write: true
      delete: false
  openai-whisper:
    audio:
      transcribe: true
    filesystem:
      read: true
      write: false
  openai-whisper-api:
    network:
      outbound: true
    audio:
      transcribe: true

  # --- Misc ---
  food-order:
    network:
      outbound: false      # no real orders without approval
  gifgrep:
    network:
      outbound: true
    filesystem:
      write: false
  summarize:
    filesystem:
      read: true
      write: false
  session-logs:
    filesystem:
      read: true
      write: false
  model-usage:
    network:
      read: true
  skill-creator:
    filesystem:
      read: true
      write: false          # don't let it self-modify skills
  canvas:
    filesystem:
      read: true
      write: true
      delete: false

# Human-in-the-loop gates — these tools always pause for confirmation
require_approval:
  - coding-agent            # any code execution
  - himalaya                # email send (when draft is approved)
  - imsg                    # iMessage send
  - voice-call              # outbound calls
  - food-order              # real purchases
  - discord                 # message send to public channels
  - tmux                    # shell interaction

# Global depth limit — no chain longer than 2 skill handoffs
skill_chain_depth: 2

# Cross-skill chaining restrictions
chaining_mode: content

skill_chaining:
  # Browsing content must not leak into email
  - bird cannot trigger himalaya
  # Code execution must not write to GitHub repos
  - coding-agent cannot trigger github
  # Email content must not trigger code execution
  - himalaya cannot trigger coding-agent
  # External web content must not trigger messaging
  - bird cannot trigger slack
  - bird cannot trigger discord
  - bird cannot trigger imsg
  # Credential access is isolated
  - 1password cannot trigger any other skill

# Data boundary zones
data_boundaries:
  pii_zone:
    skills: [slack, discord, imsg, himalaya]
    classification: pii
    rules:
      - pii_data must be redacted when crossing zone boundary
      - calendar events must not include attendee emails in slack messages
    on_violation: block_and_log

  credential_zone:
    skills: [1password]
    classification: credentials
    rules:
      - secrets cannot flow outside credential_zone
    on_violation: block_and_notify
